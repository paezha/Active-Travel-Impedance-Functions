---
title: "Calculating Walking and cycling trips impedance function- 1992"
output: html_notebook
---

# Active-transport walking and cycling behaviour in Canada

## Introduction

## Data and Method

Data on walking and cycling trips to different destinations was derived from Canada's General Social Survey (GSS) from 1986 to 2015. GSS is a social trends survey in order to monitor changes in the living conditions and well-being of Canadians and to provide information on specific social policy issues. one of the important information of GSS is about Time-use surveys. This survey collects information on all human activities and can therefore inform a broad range of policies. Statistics Canada has been conducting time-use surveys since 1986 at approximately five- to seven- year intervals, most recently in 2015.The GSS on time use employs a retrospective 24-hour time diary to collect information on respondents' participation in, and time spent on, a wide variety of day-to-day activities. In addition, information is collected on the location where these activities occurred (e.g., at home, at work, etc.).in addition, This dataset contains travel time data of Many of the Census Metropolitan Areas (CMAs) and non-CMA areas all over Canada. CMAs are including St. John's, Halifax, Saint John, Montreal, Quebec City, Toronto, Ottawa, Hamilton, Winnipeg, Regina, Saskatoon, Calgary, Edmonton, and Vancouver. and the non-CMA areas of each of the ten provinces were also grouped to form ten more strata.

walking and cycling data are categorized based on the three different destinations such as home, school and work, and others' homes. every episode includes, the start and end time of each event, duration, weight, and concurrent contextual information, such as the location of the activities (e.g., home, work, schools,...).

complete method

# Result

First load all of the libraries

```{r load-packages, include=FALSE, cache=FALSE}
#load all packages:
library(fitdistrplus)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readxl) 
library(splitstackshape)
library(tibble)
library(readr)
library(tabulate)
library(janitor)
library(kableExtra)
library(flextable)
```

Here, we are loading all the primary files of the GSS dataset to create our database for analysis.

```{r, include=FALSE, cache=FALSE}
#Read main file:
#gss_e_2015 <- read.csv("D:/GSS Data/gss-e.csv")
#gss_e_2005 <- read.csv("D:/First Article/Data/Time use_2005/gss-12M0019-E-2005-c-19-e_F1.csv")
#gss_e_2010 <- read.csv("D:/First Article/Data/Time use_2010/gss-12M0018-E-2010-c-24-tus-ef_F1.csv")
#gss_e_1998 <- read.csv("D:/First Article/Data/Time use_1998/gss-12M0012-E-1998-c-12e_F1.csv")
gss_e_1992 <- read.csv("D:/First Article/Data/Time use_1992/gss-12M0007-E-1992-c-7-ep_F1.csv")
#gss_e_1986 <- read.csv("D:/First Article/Data/Time use_1986/gss-12M0002-E-1986-c-2-ep_F1.csv")
```



```{r creating dataset for walking 1992, include=FALSE, cache=FALSE}
# **walking 1992**
# Creating data of origins and destinations of walking trip 1992
inds = which(gss_e_1992$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
walking_1992 <- gss_e_1992 [unlist(rows),] %>% 
  dplyr::select(SEQNUM, DDAY, NOEPISO, ACTCODE, STARTIME, ENDTIME, DURATION, PLACE, TIMEWGT) %>% 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) %>% 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) %>% 
  group_by(SEQNUM) %>% 
  filter(PLACE == 7) %>% 
  ungroup()

# change NA's Weight to 1 


# change destination and origins to text column
walking_1992 <- walking_1992 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

walking_1992 <- walking_1992 %>% dplyr::rename(
    PUMFID = SEQNUM,
    LOCATION = PLACE, WGHT_EPI = TIMEWGT) %>%  dplyr::select(PUMFID, DDAY, STARTIME:orig) 
walking_1992$YEAR <-  1992
walking_1992$MODE <-  "walking"
walking_1992$STARTMIN <-  1
walking_1992$ENDMIN <-  1
```

```{r creating dataset for cycling 1992, include=FALSE, cache=FALSE}

# **Cycling 1992**
# Creating data of origins and destinations of cycling trip 1992
inds = which(gss_e_1992$PLACE == 9)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycling_1992 <- gss_e_1992 [unlist(rows),] %>% 
  dplyr::select(SEQNUM, DDAY, NOEPISO, ACTCODE, STARTIME, ENDTIME, DURATION, PLACE, TIMEWGT) %>% 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) %>% 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) %>% 
  group_by(SEQNUM) %>% 
  filter(PLACE == 9) %>% 
  ungroup()

# change destination and origins to text column
cycling_1992 <- cycling_1992 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

cycling_1992 <- cycling_1992 %>% dplyr::rename(
    PUMFID = SEQNUM,
    LOCATION = PLACE,WGHT_EPI = TIMEWGT) %>%  dplyr::select(PUMFID, DDAY, STARTIME:orig) 
cycling_1992$YEAR <-  1992
cycling_1992$MODE <-  "cycling"
cycling_1992$STARTMIN <-  1
cycling_1992$ENDMIN <-  1

```

### Calculating impedance function for walking in 1992

```{r}

count <- sum(walking_1992$DURATION > 100)
print (count)

walking_1992 <- walking_1992 %>% filter(DURATION < 100)
summary(walking_1992$DURATION)
```

using a skew vs. kurtois graph to descriptive statistics of data:

```{r creating Cullen and Frey graph for walkig 1992}
# creating a skew vs. kurtois graph for walking 1992

descdist(walking_1992$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```
```{r}
summary(walking_1992$WGHT_EPI)
walking_1992$WGHT_EPI[is.na(walking_1992$WGHT_EPI)] <- 1
```


As shown in the Cullen and Frey graph, we see that gamma and exponential will likely be the best fit according to the graph above. Then we compare these models to find the best model.

```{r}

# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution

gamma_w_1992_ <- fitdistrplus::fitdist(data=walking_1992$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(walking_1992$WGHT_EPI))

fit_dgamma <- data.frame(f = dgamma(walking_1992$DURATION, shape = gamma_w_1992_$estimate[1], rate = gamma_w_1992_$estimate[2]), x = walking_1992$DURATION, type = "Gamma")

summary(gamma_w_1992_)

plot(x= fit_dgamma$x, y=fit_dgamma$f)


#Calculating exponential distribution
exp_w_1992_ <- fitdistrplus::fitdist(data=walking_1992$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(walking_1992$WGHT_EPI))

summary(exp_w_1992_)

# Get the estimated rate parameter from the fitted distribution
rate_estimate <- exp_w_1992_$estimate[1]

# Create a data frame for the fitted exponential distribution
fit_dexp <- data.frame(f = dexp(walking_1992$DURATION, rate = rate_estimate), 
                       x = walking_1992$DURATION, type = "exp")

# Plot the fitted exponential distribution
plot(x = fit_dexp$x, y = fit_dexp$f)

```

Now let's compare these models based on AIC and BIC to see which fits the walk data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(walking_1992$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(walking_1992$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 1992!

```{r}
walking_1992_gamma <- gamma_w_1992_
walking_1992 <- walking_1992 %>%
 mutate(f = dgamma(DURATION, walking_1992_gamma$estimate["shape"], walking_1992_gamma$estimate["rate"])) 
summary(walking_1992$f)

```

### Destination : Home  (1)- 1992

using a skew vs. kurtois graph to descriptive statistics of data

```{r creating Cullen and Frey graph for walkig 1992 - Home  (1)}
# creating a skew vs. kurtois graph for walking 1992

# Filter the data based on the "destination" column
 w_1_1992 <- walking_1992 %>%
  filter(destination == "1")   
descdist(w_1_1992$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As shown in the Cullen and Frey graph, we see that gamma and exponential will likely be the best fit according to the graph above. Then we compare these models to find the best model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w1_1992_ <- fitdistrplus::fitdist(data=w_1_1992$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_1_1992$WGHT_EPI))

fit_dgamma_w192 <- data.frame(f = dgamma(w_1_1992$DURATION, shape = gamma_w1_1992_$estimate[1], rate = gamma_w1_1992_$estimate[2]), x = w_1_1992$DURATION, type = "Gamma")

summary(gamma_w1_1992_)

plot(x= fit_dgamma_w192$x, y=fit_dgamma_w192$f)

#Calculating exponential distribution
exp_w1_1992_ <- fitdistrplus::fitdist(data=w_1_1992$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_1_1992$WGHT_EPI))

summary(exp_w1_1992_)

fit_dexp_w192 <- data.frame(f = dexp(w_1_1992$DURATION, rate = exp_w1_1992_$estimate[1]), 
                       x = w_1_1992$DURATION, type = "exp")

plot(x = fit_dexp_w192$x, y = fit_dexp_w192$f)

```

Now let's compare these models AIC and BIC to see which fits the walk data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(w_1_1992$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_1_1992$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 1992!

```{r}
walking_192_gamma <- gamma_w1_1992_
w_1_1992 <- w_1_1992 %>%
 mutate(f_1 = dgamma(DURATION, walking_192_gamma$estimate["shape"], walking_192_gamma$estimate["rate"])) 
summary(w_1_1992$f_1)
```


### Destination : Work place (2)- 1992

using a skew vs. kurtois graph to descriptive statistics of data

```{r creating Cullen and Frey graph for walkig 1992 - Work place (2)}
# creating a skew vs. kurtois graph for walking 1992

# Filter the data based on the "destination" column
 w_2_1992 <- walking_1992 %>%
  filter(destination == "2")   
descdist(w_2_1992$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As shown in the Cullen and Frey graph, we see that gamma and exponential will likely be the best fit according to the graph above. Then we compare these models to find the best model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w2_1992_ <- fitdistrplus::fitdist(data=w_2_1992$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_2_1992$WGHT_EPI))

fit_dgamma_w292 <- data.frame(f = dgamma(w_2_1992$DURATION, shape = gamma_w2_1992_$estimate[1], rate = gamma_w2_1992_$estimate[2]), x = w_2_1992$DURATION, type = "Gamma")

summary(gamma_w2_1992_)

plot(x= fit_dgamma_w292$x, y=fit_dgamma_w292$f)

#Calculating exponential distribution
exp_w2_1992_ <- fitdistrplus::fitdist(data=w_2_1992$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_2_1992$WGHT_EPI))

summary(exp_w2_1992_)

fit_dexp_w292 <- data.frame(f = dexp(w_2_1992$DURATION, rate = exp_w2_1992_$estimate[1]), 
                       x = w_2_1992$DURATION, type = "exp")

plot(x = fit_dexp_w292$x, y = fit_dexp_w292$f)

```

Now let's compare these models AIC and BIC to see which fits the walk data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(w_2_1992$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_2_1992$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 1992!

```{r}
walking_292_gamma <- gamma_w2_1992_
w_2_1992 <- w_2_1992 %>%
 mutate(f_2 = dgamma(DURATION, walking_292_gamma$estimate["shape"], walking_292_gamma$estimate["rate"])) 
summary(w_2_1992$f_2)
```

### Destination : Other's Home (3)- 1992

using a skew vs. kurtois graph to descriptive statistics of data

```{r creating Cullen and Frey graph for walkig 1992 - Other Home (3)}
# creating a skew vs. kurtois graph for walking 1992

# Filter the data based on the "destination" column
 w_3_1992 <- walking_1992 %>%
  filter(destination == "3")   
descdist(w_3_1992$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As shown in the Cullen and Frey graph, we see that gamma, weibull and exponential will likely be the best fit according to the graph above. Then we compare these models to find the best model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w3_1992_ <- fitdistrplus::fitdist(data=w_3_1992$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_3_1992$WGHT_EPI))

fit_dgamma_w392 <- data.frame(f = dgamma(w_3_1992$DURATION, shape = gamma_w3_1992_$estimate[1], rate = gamma_w3_1992_$estimate[2]), x = w_3_1992$DURATION, type = "Gamma")

summary(gamma_w3_1992_)

plot(x= fit_dgamma_w392$x, y=fit_dgamma_w392$f)


#Calculating weibull distribution 
weibull_w3_1992_ <- fitdistrplus::fitdist(data=w_3_1992$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_3_1992$WGHT_EPI))

fit_dweibull_w392 <- data.frame(f = dweibull(w_3_1992$DURATION, shape = weibull_w3_1992_$estimate[1], scale = weibull_w3_1992_$estimate[2]), x = w_3_1992$DURATION, type = "weibull")

summary(weibull_w3_1992_)

plot(x= fit_dweibull_w392$x, y=fit_dweibull_w392$f)


#Calculating exponential distribution
exp_w3_1992_ <- fitdistrplus::fitdist(data=w_3_1992$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_3_1992$WGHT_EPI))

summary(exp_w3_1992_)

fit_dexp_w392 <- data.frame(f = dexp(w_3_1992$DURATION, rate = exp_w3_1992_$estimate[1]), 
                       x = w_3_1992$DURATION, type = "exp")

plot(x = fit_dexp_w392$x, y = fit_dexp_w392$f)

```

Now let's compare these models AIC and BIC to see which fits the walk data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(w_3_1992$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_3_1992$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_3_1992$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 1998!

```{r}
walking_392_gamma <- gamma_w3_1992_
w_3_1992 <- w_3_1992 %>%
 mutate(f_3 = dgamma(DURATION, walking_392_gamma$estimate["shape"], walking_392_gamma$estimate["rate"])) 
summary(w_3_1992$f_3)
```



### Calculating impedance function for cycling in 1992

```{r}

count <- sum(cycling_1992$DURATION > 100)
print (count)

cycling_1992 <- cycling_1992 %>% filter(DURATION < 100)
summary(cycling_1992$DURATION)
```


using a skew vs. kurtois graph to descriptive statistics of data:

```{r creating Cullen and Frey graph for cycling 1992}
# creating a skew vs. kurtois graph for cycling 1992

descdist(cycling_1992$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As shown in the Cullen and Frey graph, we see that gamma and exponential will likely be the best fit according to the graph above. Then we compare these models to find the best model.

```{r}
summary(cycling_1992$DURATION)
```

```{r}

# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution

gamma_c_1992_ <- fitdistrplus::fitdist(data=cycling_1992$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(cycling_1992$WGHT_EPI))


fit_dgamma <- data.frame(f = dgamma(cycling_1992$DURATION, shape = gamma_c_1992_$estimate[1], rate = gamma_c_1992_$estimate[2]), x = cycling_1992$DURATION, type = "gamma")

summary(gamma_c_1992_)

plot(x= fit_dgamma$x, y=fit_dgamma$f)


#Calculating exponential distribution
exp_c_1992_ <- fitdistrplus::fitdist(data=cycling_1992$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(cycling_1992$WGHT_EPI))

summary(exp_c_1992_)

fit_dexp <- data.frame(f = dexp(cycling_1992$DURATION, rate = exp_c_1992_$estimate[1]), x = cycling_1992$DURATION, type = "exp")

plot(x= fit_dexp$x, y=fit_dexp$f)


```

Now let's compare these models based on AIC and BIC to see which fits the walk data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(cycling_1992$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(cycling_1992$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 1992!

```{r}
cycling_1992_gamma <- gamma_c_1992_
cycling_1992 <- cycling_1992 %>%
 mutate(f = dgamma(DURATION, cycling_1992_gamma$estimate["shape"] , cycling_1992_gamma$estimate["rate"])) 
summary(cycling_1992$f)

```


### Destination : Cycling - Home  (1), 1992

using a skew vs. kurtois graph to descriptive statistics of data

```{r creating Cullen and Frey graph for cycling 1992 - Home  (1)}
# creating a skew vs. kurtois graph for cycling 1992

# Filter the data based on the "destination" column
 c_1_1992 <- cycling_1992 %>%
  filter(destination == "1")   
descdist(c_1_1992$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As shown in the Cullen and Frey graph, we see that gamma, weibull and exponential will likely be the best fit according to the graph above. Then we compare these models to find the best model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_c1_1992_ <- fitdistrplus::fitdist(data=c_1_1992$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_1_1992$WGHT_EPI))

fit_dgamma_c192 <- data.frame(f = dgamma(c_1_1992$DURATION, shape = gamma_c1_1992_$estimate[1], rate = gamma_c1_1992_$estimate[2]), x = c_1_1992$DURATION, type = "Gamma")

summary(gamma_c1_1992_)

plot(x= fit_dgamma_c192$x, y=fit_dgamma_c192$f)


#Calculating weibull distribution 
weibull_c1_1992_ <- fitdistrplus::fitdist(data=c_1_1992$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(c_1_1992$WGHT_EPI))

fit_dweibull_c192 <- data.frame(f = dweibull(c_1_1992$DURATION, shape = weibull_c1_1992_$estimate[1], scale = weibull_c1_1992_$estimate[2]), x = c_1_1992$DURATION, type = "weibull")

summary(weibull_c1_1992_)

plot(x= fit_dweibull_c192$x, y=fit_dweibull_c192$f)

#Calculating exponential distribution
exp_c1_1992_ <- fitdistrplus::fitdist(data=c_1_1992$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_1_1992$WGHT_EPI))

summary(exp_c1_1992_)

fit_dexp_c192 <- data.frame(f = dexp(c_1_1992$DURATION, rate = exp_c1_1992_$estimate[1]), 
                       x = c_1_1992$DURATION, type = "exp")

plot(x = fit_dexp_c192$x, y = fit_dexp_c192$f)

```

Now let's compare these models AIC and BIC to see which fits the walk data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(c_1_1992$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_1_1992$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(c_1_1992$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 1992!

```{r}
cycling_192_gamma <- gamma_c1_1992_
c_1_1992 <- c_1_1992 %>%
 mutate(f_1 = dgamma(DURATION, cycling_192_gamma$estimate["shape"], cycling_192_gamma$estimate["rate"])) 
summary(c_1_1992$f_1)
```


### Destination :cycling- Work place (2), 1992

using a skew vs. kurtois graph to descriptive statistics of data

```{r creating Cullen and Frey graph for cycling 1992 - cycling- Work place (2)}
# creating a skew vs. kurtois graph for cycling 1992

# Filter the data based on the "destination" column
 c_2_1992 <- cycling_1992 %>%
  filter(destination == "2")   
descdist(c_2_1992$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As shown in the Cullen and Frey graph, we see that gamma ,weibull,  normal and exponential will likely be the best fit according to the graph above. Then we compare these models to find the best model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_c2_1992_ <- fitdistrplus::fitdist(data=c_2_1992$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_2_1992$WGHT_EPI))

fit_dgamma_c292 <- data.frame(f = dgamma(c_2_1992$DURATION, shape = gamma_c2_1992_$estimate[1], rate = gamma_c2_1992_$estimate[2]), x = c_2_1992$DURATION, type = "Gamma")

summary(gamma_c2_1992_)

plot(x= fit_dgamma_c292$x, y=fit_dgamma_c292$f)

#Calculating weibull distribution 
weibull_c2_1992_ <- fitdistrplus::fitdist(data=c_2_1992$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(c_2_1992$WGHT_EPI))

fit_dweibull_c292 <- data.frame(f = dweibull(c_2_1992$DURATION, shape = weibull_c2_1992_$estimate[1], scale = weibull_c2_1992_$estimate[2]), x = c_2_1992$DURATION, type = "weibull")

summary(weibull_c2_1992_)

plot(x= fit_dweibull_c292$x, y=fit_dweibull_c292$f)

#Calculating normal distribution 
norm_c2_1992_ <- fitdistrplus::fitdist(data=c_2_1992$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_2_1992$WGHT_EPI))

fit_dnorm_c292 <- data.frame(f = dnorm(c_2_1992$DURATION, mean = norm_c2_1992_$estimate[1], sd = norm_c2_1992_$estimate[2]), x = c_2_1992$DURATION, type = "norm")

summary(norm_c2_1992_)

plot(x= fit_dnorm_c292$x, y=fit_dnorm_c292$f)

#Calculating exponential distribution
exp_c2_1992_ <- fitdistrplus::fitdist(data=c_2_1992$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_2_1992$WGHT_EPI))

summary(exp_c2_1992_)

fit_dexp_c292 <- data.frame(f = dexp(c_2_1992$DURATION, rate = exp_c2_1992_$estimate[1]), 
                       x = c_2_1992$DURATION, type = "exp")

plot(x = fit_dexp_c292$x, y = fit_dexp_c292$f)

```

Now let's compare these models AIC and BIC to see which fits the walk data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(c_2_1992$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_2_1992$DURATION%>% unlist() %>% as.numeric(),"normal"))
broom::glance(MASS::fitdistr(c_2_1992$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(c_2_1992$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 1992!

```{r}
cycling_292_gamma <- gamma_c2_1992_
c_2_1992 <- c_2_1992 %>%
 mutate(f_2 = dgamma(DURATION, cycling_292_gamma$estimate["shape"], cycling_292_gamma$estimate["rate"])) 
summary(c_2_1992$f_2)
```

### Destination : Cycling - Other's Home (3), 1998

using a skew vs. kurtois graph to descriptive statistics of data

```{r creating Cullen and Frey graph for cycling 1992 - Other Home (3)}
# creating a skew vs. kurtois graph for cycling 1992

# Filter the data based on the "destination" column
c_3_1992 <- cycling_1992 %>%
  filter(destination == "3")   
descdist(c_3_1992$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As shown in the Cullen and Frey graph, we see that gamma, normal, lognormal and exponential will likely be the best fit according to the graph above. Then we compare these models to find the best model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_c3_1992_ <- fitdistrplus::fitdist(data=c_3_1992$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_3_1992$WGHT_EPI))

fit_dgamma_c392 <- data.frame(f = dgamma(c_3_1992$DURATION, shape = gamma_c3_1992_$estimate[1], rate = gamma_c3_1992_$estimate[2]), x = c_3_1992$DURATION, type = "Gamma")

summary(gamma_c3_1992_)

plot(x= fit_dgamma_c392$x, y=fit_dgamma_c392$f)


#Calculating normal distribution 
norm_c3_1992_ <- fitdistrplus::fitdist(data=c_3_1992$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_3_1992$WGHT_EPI))

fit_dnorm_c392 <- data.frame(f = dnorm(c_3_1992$DURATION, mean = norm_c3_1992_$estimate[1], sd = norm_c3_1992_$estimate[2]), x = c_3_1992$DURATION, type = "norm")

summary(norm_c3_1992_)

plot(x= fit_dnorm_c392$x, y=fit_dnorm_c392$f)

#Calculating lognormal distribution 
lnorm_c3_1992_ <- fitdistrplus::fitdist(data=c_3_1992$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(c_3_1992$WGHT_EPI))

fit_dlnorm_c392 <- data.frame(f = dlnorm(c_3_1992$DURATION, meanlog = lnorm_c3_1992_$estimate[1], sdlog = lnorm_c3_1992_$estimate[2]), x = c_3_1992$DURATION, type = "lnorm")

summary(lnorm_c3_1992_)

plot(x= fit_dlnorm_c392$x, y=fit_dlnorm_c392$f)

#Calculating exponential distribution
exp_c3_1992_ <- fitdistrplus::fitdist(data=c_3_1992$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_3_1992$WGHT_EPI))

summary(exp_c3_1992_)

fit_dexp_c392 <- data.frame(f = dexp(c_3_1992$DURATION, rate = exp_c3_1992_$estimate[1]), 
                       x = c_3_1992$DURATION, type = "exp")

plot(x = fit_dexp_c392$x, y = fit_dexp_c392$f)

```

Now let's compare these models AIC and BIC to see which fits the walk data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(c_3_1992$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_3_1992$DURATION%>% unlist() %>% as.numeric(),"normal"))
broom::glance(MASS::fitdistr(c_3_1992$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
broom::glance(MASS::fitdistr(c_3_1992$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, lognormal has largest logLik and the smallest AIC and BIC. we will pick lognormal function for cycling trips in 1992!

```{r}
cycling_392_lnorm <- lnorm_c3_1992_
c_3_1992 <- c_3_1992 %>%
 mutate(f_3 = dlnorm(DURATION, cycling_392_lnorm$estimate["meanlog"], cycling_392_lnorm$estimate["sdlog"])) 
summary(c_3_1992$f_3)
```



creating a new walking data frame that have all the f values for walking 1992

```{r}
walking_1992_f <- bind_rows(w_1_1992, w_2_1992, w_3_1992)

```


creating a new cycling data frame that have all the f values for cycling 1992

```{r}
cycling_1992_f <- bind_rows(c_1_1992, c_2_1992, c_3_1992)

```
