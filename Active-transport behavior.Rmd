---
output:
  pdf_document: default
  html_document: default
---
|                                          |
|------------------------------------------|
| tle: "Active-transport walking behavior" |
| tput:                                    |
| pdf_document: default                    |
| html_document: default                   |
| te: '2022-05-19'                         |

# Active-transport walking and cycling behaviour in Canada

## Introduction

## Data and Method

Data on walking and cycling trips to different destinations was derived from Canada's General Social Survey (GSS) from 1986 to 2015. GSS is a social trends survey in order to monitor changes in the living conditions and well-being of Canadians and to provide information on specific social policy issues. one of the important information of GSS is about Time-use surveys. This survey collects information on all human activities and can therefore inform a broad range of policies. Statistics Canada has been conducting time-use surveys since 1986 at approximately five- to seven- year intervals, most recently in 2015.The GSS on time use employs a retrospective 24-hour time diary to collect information on respondents' participation in, and time spent on, a wide variety of day-to-day activities. In addition, information is collected on the location where these activities occurred (e.g., at home, at work, etc.).in addition, This dataset contains travel time data of Many of the Census Metropolitan Areas (CMAs) and non-CMA areas all over Canada. CMAs are including St. John's, Halifax, Saint John, Montreal, Quebec City, Toronto, Ottawa, Hamilton, Winnipeg, Regina, Saskatoon, Calgary, Edmonton, and Vancouver. and the non-CMA areas of each of the ten provinces were also grouped to form ten more strata.

walking and cycling data are categorized based on the three different destinations such as home, school and work, and others' homes. every episode includes, the start and end time of each event, duration, weight, and concurrent contextual information, such as the location of the activities (e.g., home, work, schools,...).

complete method

# Result

First load all of the libraries

```{r load-packages, include=FALSE, cache=FALSE}
#load all packages:
library(fitdistrplus)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readxl) 
library(splitstackshape)
library(tibble)
library(readr)
library(tabulate)
library(janitor)
library(kableExtra)
library(flextable)
library(gt)
```

Here, we are loading all the primary files of the GSS dataset to create our database for analysis.

```{r, include=FALSE, cache=FALSE}
#Read main file:
gss_e_2015 <- read.csv("D:/GSS Data/gss-e.csv")
gss_e_2005 <- read.csv("D:/First Article/Data/Time use_2005/gss-12M0019-E-2005-c-19-e_F1.csv")
gss_e_2010 <- read.csv("D:/First Article/Data/Time use_2010/gss-12M0018-E-2010-c-24-tus-ef_F1.csv")
gss_e_1998 <- read.csv("D:/First Article/Data/Time use_1998/gss-12M0012-E-1998-c-12e_F1.csv")
gss_e_1992 <- read.csv("D:/First Article/Data/Time use_1992/gss-12M0007-E-1992-c-7-ep_F1.csv")
gss_e_1986 <- read.csv("D:/First Article/Data/Time use_1986/gss-12M0002-E-1986-c-2-ep_F1.csv")
```

Creating dataset for walking 2015 in order to filter walking trips


First, we create a dataset about walking trips in 1986. Then, we add two extra columns to this data. These columns show where people started their walks and where they ended them (origin and destination). Here's how we do it:



# Descriptive analysis

first create a new data set to analysis count, mean, min and max of each year and mode:

```{r creating dataset for walking 2015, include=FALSE, cache=FALSE}

# **walking 2015**
# Creating data of origins and destinations of walking trip 2015
inds = which(gss_e_2015$LOCATION == 315)
rows <- lapply(inds, function(x) (x-1):(x+1))
walk_2015 <- gss_e_2015 [unlist(rows),] %>% 
  dplyr::select(PUMFID:LOCATION) %>% 
  mutate(origin = lag(LOCATION, order_by = PUMFID)) %>% 
  mutate(destination = lead(LOCATION, order_by = PUMFID)) %>% 
  group_by(PUMFID) %>% 
  filter(LOCATION == 315) %>% 
  ungroup()

# change destination and origins to text column
walk_2015 <- walk_2015 %>%  filter(destination == 300 | destination == 301 | destination == 303 | destination == 302 | destination == 305 |destination == 306 | destination == 307 |destination == 309 | destination == 310 ) %>% filter(origin == 300 | origin == 301 | origin == 303 | origin == 302 | origin == 305 | origin == 306 | origin == 307  | origin == 309 | origin == 310 ) %>% 
  mutate(dest =
                     case_when(destination == 300 ~ "home", 
                               destination == 301 ~ "work or school",
                               destination == 303 ~ "other's home",
                               destination == 302 ~ "business",
                               destination == 305 ~ "outdoors",
                               destination == 306 ~ "Grocery store, other stores or mall",
                               destination == 307 ~ "Library, museum or theatre",
                               destination == 309 ~ "Restaurant, bar or club",
                               destination == 310 ~ "Place of worship")) %>% 
  mutate(orig =
                     case_when(origin == 300 ~ "home", 
                               origin == 301 ~ "work or school",
                               origin == 303 ~ "other's home",
                               origin == 302 ~ "business",
                               origin == 305 ~ "outdoors",
                               origin == 306 ~ "Grocery store, other stores or mall",
                               origin == 307 ~ "Library, museum or theatre",
                               origin == 309 ~ "Restaurant, bar or club",
                               origin == 310 ~ "Place of worship"))

walk_2015 <- walk_2015 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
walk_2015$YEAR <-  2015
walk_2015$MODE <-  "walking"
```


```{r creating dataset for cycling 2015, include=FALSE, cache=FALSE}

# cycling _2015
# Creating data of origins and destinations of cycling trip 2015
inds = which(gss_e_2015$LOCATION == 318)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycle_2015 <- gss_e_2015[unlist(rows),] %>% 
  dplyr::select(PUMFID:LOCATION) %>% 
  mutate(origin = lag(LOCATION, order_by = PUMFID)) %>% 
  mutate(destination = lead(LOCATION, order_by = PUMFID)) %>% 
  group_by(PUMFID) %>% 
  filter(LOCATION == 318)

# change destination and origins to text column
cycle_2015 <- cycle_2015 %>%  filter(destination == 300 | destination == 301 | destination == 303 | destination == 302 | destination == 305 |destination == 306 | destination == 307 | destination == 309 | destination == 310 ) %>% filter(origin == 300 | origin == 301 | origin == 303 | origin == 302 | origin == 305 | origin == 306 | origin == 307 | origin == 309 | origin == 310) %>% 
  mutate(dest =
                     case_when(destination == 300 ~ "home", 
                               destination == 301 ~ "work or school",
                               destination == 303 ~ "other's home",
                               destination == 302 ~ "business",
                               destination == 305 ~ "outdoors",
                               destination == 306 ~ "Grocery store, other stores or mall",
                               destination == 307 ~ "Library, museum or theatre",
                               destination == 309 ~ "Restaurant, bar or club",
                               destination == 310 ~ "Place of worship")) %>% 
  mutate(orig =
                     case_when(origin == 300 ~ "home", 
                               origin == 301 ~ "work or school",
                               origin == 303 ~ "other's home",
                               origin == 302 ~ "business",
                               origin == 305 ~ "outdoors",
                               origin == 306 ~ "Grocery store, other stores or mall",
                               origin == 307 ~ "Library, museum or theatre",
                               origin == 309 ~ "Restaurant, bar or club",
                               origin == 310 ~ "Place of worship"))

cycle_2015 <- cycle_2015 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
cycle_2015$YEAR <-  2015
cycle_2015$MODE <-  "cycling"
```

```{r creating dataset for walking 2010, include=FALSE, cache=FALSE}

# **walking 2010**
# Creating data of origins and destinations of walking trip 2010
inds = which(gss_e_2010$PLACE == 14)
rows <- lapply(inds, function(x) (x-1):(x+1))
walk_2010 <- gss_e_2010 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 14) %>% 
  ungroup()

# change destination and origins to text column
walk_2010 <- walk_2010 %>%  filter(destination == 1 | destination == 2 | destination == 3 | destination == 4 | destination == 5 |destination == 6 | destination == 7 | destination == 8 | destination == 9 | destination == 10 ) %>% filter(origin == 1 | origin == 2 | origin == 3 | origin == 4 | origin == 5 | origin == 6 | origin == 7 | origin == 8 | origin == 9 | origin == 10) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home",
                               destination == 4 ~ "Restaurant/bar",
                               destination == 5 ~ "Place of worship",
                               destination == 6 ~ "Grocery store, other stores or mall",
                               destination == 7 ~ "Grocery store, other stores or mall",
                               destination == 8 ~ "work or school",
                               destination == 9 ~ "Outdoors away from home",
                               destination == 10 ~ "Library" )) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home",
                               origin == 4 ~ "Restaurant/bar",
                               origin == 5 ~ "Place of worship",
                               origin == 6 ~ "Grocery store, other stores or mall",
                               origin == 7 ~ "Grocery store, other stores or mall",
                               origin == 8 ~ "work or school",
                               origin == 9 ~ "Outdoors away from home",
                               origin == 10 ~ "Library"))

walk_2010 <- walk_2010 %>%
  rename(PUMFID = RECID,
         LOCATION = PLACE)

walk_2010 <- walk_2010 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
walk_2010$YEAR <-  2010
walk_2010$MODE <-  "walking"
```

```{r creating dataset for cycling 2010, include=FALSE, cache=FALSE}

# cycling _2010
# Creating data of origins and destinations of cycling trip 2010
inds = which(gss_e_2010$PLACE == 17)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycle_2010 <- gss_e_2010[unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 17)

# change destination and origins to text column
cycle_2010 <- cycle_2010 %>%  filter(destination == 1 | destination == 2 | destination == 3 | destination == 6 | destination == 7 | destination == 8 | destination == 9 ) %>% filter(origin == 1 | origin == 2 | origin == 3 | origin == 6 | origin == 7 | origin == 8 | origin == 9 ) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home",
                               destination == 6 ~ "Grocery store, other stores or mall",
                               destination == 7 ~ "Grocery store, other stores or mall",
                               destination == 8 ~ "work or school",
                               destination == 9 ~ "Outdoors away from home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home",
                               origin == 6 ~ "Grocery store, other stores or mall",
                               origin == 7 ~ "Grocery store, other stores or mall",
                               origin == 8 ~ "work or school",
                               origin == 9 ~ "Outdoors away from home"))

cycle_2010 <- cycle_2010 %>%
  rename(PUMFID = RECID,
         LOCATION = PLACE)

cycle_2010 <- cycle_2010 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
cycle_2010$YEAR <-  2010
cycle_2010$MODE <-  "cyclingtrip"
```

```{r creating dataset for walking 2005, include=FALSE, cache=FALSE}

# **walking 2005**
# Creating data of origins and destinations of walking trip 2005
inds = which(gss_e_2005$PLACE == 14)
rows <- lapply(inds, function(x) (x-1):(x+1))
walk_2005 <- gss_e_2005 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 14) %>% 
  ungroup()

# change destination and origins to text column
walk_2005 <- walk_2005 %>%  filter(destination == 1 | destination == 2 | destination == 3 | destination == 8 | destination == 4 | destination == 5 | destination == 6 | destination == 7 | destination == 9 | destination == 10 ) %>% filter(origin == 1 | origin == 2 | origin == 3 | origin == 8 | origin == 4 | origin == 5 | origin == 6 | origin == 7 | origin == 9 | origin == 10) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home",
                               destination == 8 ~ "work or school",
                               destination == 4 ~ "Restaurant, bar or club",
                               destination == 5 ~ "Place of worship",
                               destination == 6 ~ "Grocery store, other stores or mall",
                               destination == 7 ~ "Grocery store, other stores or mall",
                               destination == 9 ~ "outdoors",
                               destination == 10 ~ "Library, museum or theatre")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home",
                               origin == 8 ~ "work or school",
                               origin == 4 ~ "Restaurant, bar or club",
                               origin == 5 ~ "Place of worship",
                               origin == 6 ~ "Grocery store, other stores or mall",
                               origin == 7 ~ "Grocery store, other stores or mall",
                               origin == 9 ~ "outdoors",
                               origin == 10 ~ "Library, museum or theatre"))

walk_2005 <- walk_2005 %>% dplyr::rename(
    PUMFID = RECID,
    STARTMIN = STARMIN,
    LOCATION = PLACE)

walk_2005 <- walk_2005 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
walk_2005$YEAR <-  2005
walk_2005$MODE <-  "walking"
```

```{r creating dataset for cycling 2005, include=FALSE, cache=FALSE}

# **CYCLING 2005**
# Creating data of origins and destinations of cycling trip 2005
inds = which(gss_e_2005$PLACE == 17)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycle_2005 <- gss_e_2005 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 17) %>% 
  ungroup()

# change destination and origins to text column
cycle_2005 <- cycle_2005 %>%  filter(destination == 1 | destination == 2 | destination == 3 | destination == 8 | destination == 4 |  destination == 6 | destination == 7 | destination == 9 ) %>% filter(origin == 1 | origin == 2 | origin == 3 | origin == 8 | origin == 4 | origin == 6 | origin == 7 | origin == 9 ) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home",
                               destination == 8 ~ "work or school",
                               destination == 4 ~ "Restaurant, bar or club",
                               destination == 6 ~ "Grocery store, other stores or mall",
                               destination == 7 ~ "Grocery store, other stores or mall",
                               destination == 9 ~ "outdoors")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home",
                               origin == 8 ~ "work or school",
                               origin == 4 ~ "Restaurant, bar or club",
                               origin == 6 ~ "Grocery store, other stores or mall",
                               origin == 7 ~ "Grocery store, other stores or mall",
                               origin == 9 ~ "outdoors"))

cycle_2005 <- cycle_2005 %>% dplyr::rename(
    PUMFID = RECID,
    STARTMIN = STARMIN,
    LOCATION = PLACE) %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
cycle_2005$YEAR <-  2005
cycle_2005$MODE <-  "cycling"
```

```{r creating dataset for walking 1998, include=FALSE, cache=FALSE}

# **walking 1998**
# Creating data of origins and destinations of walking trip 1998
inds = which(gss_e_1998$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
walk_1998 <- gss_e_1998 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 7) %>% 
  ungroup()

# change destination and origins to text column
walk_1998 <- walk_1998 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

walk_1998 <- walk_1998 %>% dplyr::rename(
    PUMFID = RECID,
    STARTMIN = STARMIN,
    WGHT_EPI = WGHTEPI,
    LOCATION = PLACE) %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
walk_1998$YEAR <-  1998
walk_1998$MODE <-  "walking"
```

```{r creating dataset for cycling 1998, include=FALSE, cache=FALSE}

# **Cycling 1998**
# Creating data of origins and destinations of cycling trip 1998
inds = which(gss_e_1998$PLACE == 9)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycle_1998 <- gss_e_1998 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 9) %>% 
  ungroup()

# change destination and origins to text column
cycle_1998 <- cycle_1998 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

cycle_1998 <- cycle_1998 %>% dplyr::rename(
    PUMFID = RECID,
    STARTMIN = STARMIN,
    WGHT_EPI = WGHTEPI,
    LOCATION = PLACE) %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
cycle_1998$YEAR <-  1998
cycle_1998$MODE <-  "cycling"
```

```{r creating dataset for walking 1992, include=FALSE, cache=FALSE}
# **walking 1992**
# Creating data of origins and destinations of walking trip 1992
inds = which(gss_e_1992$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
walk_1992 <- gss_e_1992 [unlist(rows),] %>% 
  dplyr::select(SEQNUM, DDAY, NOEPISO, ACTCODE, STARTIME, ENDTIME, DURATION, PLACE, TIMEWGT) %>% 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) %>% 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) %>% 
  group_by(SEQNUM) %>% 
  filter(PLACE == 7) %>% 
  ungroup()

# change NA's Weight to 1 


# change destination and origins to text column
walk_1992 <- walk_1992 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

walk_1992 <- walk_1992 %>% dplyr::rename(
    PUMFID = SEQNUM,
    LOCATION = PLACE, WGHT_EPI = TIMEWGT) %>%  dplyr::select(PUMFID, DDAY, STARTIME:orig) 
walk_1992$YEAR <-  1992
walk_1992$MODE <-  "walking"
walk_1992$STARTMIN <-  1
walk_1992$ENDMIN <-  1
```

```{r creating dataset for cycling 1992, include=FALSE, cache=FALSE}

# **Cycling 1992**
# Creating data of origins and destinations of cycling trip 1992
inds = which(gss_e_1992$PLACE == 9)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycle_1992 <- gss_e_1992 [unlist(rows),] %>% 
  dplyr::select(SEQNUM, DDAY, NOEPISO, ACTCODE, STARTIME, ENDTIME, DURATION, PLACE, TIMEWGT) %>% 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) %>% 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) %>% 
  group_by(SEQNUM) %>% 
  filter(PLACE == 9) %>% 
  ungroup()

# change destination and origins to text column
cycle_1992 <- cycle_1992 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

cycle_1992 <- cycle_1992 %>% dplyr::rename(
    PUMFID = SEQNUM,
    LOCATION = PLACE,WGHT_EPI = TIMEWGT) %>%  dplyr::select(PUMFID, DDAY, STARTIME:orig) 
cycle_1992$YEAR <-  1992
cycle_1992$MODE <-  "cycling"
cycle_1992$STARTMIN <-  1
cycle_1992$ENDMIN <-  1

```

```{r creating dataset for walking 1986, include=FALSE, cache=FALSE}

# **walking 1986**
# Creating data of origins and destinations of walking trip 1986
inds = which(gss_e_1986$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
walk_1986 <- gss_e_1986 [unlist(rows),] %>% 
  dplyr::select(SEQNUM, DDAY, NO_EPISO, ACT_CODE, STRTTIME, ENDTIME, DURATION, PLACE, FWGT_MS) %>% 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) %>% 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) %>% 
  group_by(SEQNUM) %>% 
  filter(PLACE == 7) %>% 
  ungroup()
summary(walk_1986$PLACE)

# change destination and origins to text column
walk_1986 <- walk_1986 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

walk_1986 <- walk_1986 %>% dplyr::rename(
    PUMFID = SEQNUM,
    LOCATION = PLACE, WGHT_EPI = FWGT_MS, STARTIME = STRTTIME) %>%  dplyr::select(PUMFID, DDAY, STARTIME:orig) 
walk_1986$YEAR <-  1986
walk_1986$MODE <-  "walking"
walk_1986$STARTMIN <-  1
walk_1986$ENDMIN <-  1
```

```{r, include=FALSE,  cache=FALSE}
# creating an integrated data frame from 1992 to 2015
trip <- rbind(walk_2015, cycle_2015, walk_2010,cycle_2010, walk_2005, cycle_2005, cycle_1998, walk_1998, walk_1992, cycle_1992, walk_1986)

#change cyclingtrip in cycling_2010 to cycling 
unique_modes <- unique(trip$MODE)
print(unique_modes)
trip$MODE[trip$MODE == "cyclingtrip"] <- "cycling"


#change of the name of some values in the dest column in the dataset 

trip <- trip %>%
  mutate(dest = case_when(
    dest == "Restaurant/bar" ~ "Restaurant, bar or club",
    dest == "Outdoors away from home" ~ "outdoors",
    dest == "Library" ~ "Library, museum or theatre",
    TRUE ~ dest  # This line ensures other values remain unchanged
  ))

```



To depict the range of trips, we designed a statistical table that presents the minimum, mean, and maximum values.

```{r}
# Calculate the count of trips for each mode and year
trip_counts <- trip %>%
  group_by(YEAR, MODE) %>%
  summarise(Count = n(), .groups = "drop") %>%
  pivot_wider(names_from = YEAR, values_from = Count)

# Process the data for the desired format
stats_data <- trip %>%
  group_by(YEAR, MODE) %>%
  summarise(
    min = min(DURATION),
    mean = mean(DURATION),
    max = max(DURATION),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(min, mean, max), names_to = "Statistic", values_to = "Value") %>%
  pivot_wider(names_from = YEAR, values_from = Value)

# Combining counts and stats_data
final_data <- bind_rows(
  trip_counts %>% mutate(Statistic = "Count"),
  stats_data
) %>%
  mutate(MODE = factor(MODE, levels = c("walking", "cycling"))) %>%
  arrange(MODE, Statistic) %>%
  select(MODE, Statistic, everything())

## Add a helper column to enforce ordering
final_data <- final_data %>%
  mutate(order_helper = case_when(
    MODE == "walking" ~ 1,
    MODE == "cycling" ~ 2,
    TRUE ~ 3
  )) %>%
  arrange(order_helper, Statistic) %>%
  select(-order_helper)
# Create the table using gt
table_1 <- final_data %>%
  gt() %>%
  tab_header(
    title = "Descriptive statistics pertaining to walking and cycling trips from 1986 to 2015"
  ) %>%
  fmt_number(
    columns = vars(-MODE, -Statistic), 
    decimals = 1
  ) %>%
  data_color(
    columns = -c(1,2),
    colors = scales::col_numeric(
      palette = c("white", "lightblue"),
      domain = NULL
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "lightgray"),
    locations = cells_body(rows = 1:4)
  ) %>%
  # Add the row grouping for the 'MODE' column
  tab_row_group(
    group = "walking",
    rows = 1:4
  ) %>%
  tab_row_group(
    group = "cycling",
    rows = 5:8
  ) %>%
  # Hide the MODE column
  cols_hide(columns = c("MODE"))

table_1

# Convert the table to raw HTML
html_content <- as_raw_html(table_1)

# Write the content to an HTML file
writeLines(html_content, "table_1.html")

system("wkhtmltopdf table_1.html table_1.pdf")

```




```{r}
library(dplyr)
library(tidyr)
library(gt)

# Filter for walking trips, selected years, and calculate statistics
walking_stats_data <- trip %>%
  filter(MODE == "walking", YEAR %in% c(2005, 2010, 2015)) %>%
  group_by(YEAR, dest) %>%
  summarise(
    Count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(Count, min, median, max), names_to = "statistic") %>%
  unite("YEAR_statistic", YEAR, statistic, sep = "_")

# Pivot data to have years as columns
wide_data <- walking_stats_data %>%
  pivot_wider(names_from = YEAR_statistic, values_from = value)

# Create the table using gt
gt_output <- wide_data %>%
  gt() %>%
  tab_header(
    title = "Walking Trip Duration Statistics by Destination for Selected Years"
  ) %>%
  cols_label(
    dest = "Destination",
    `2005_Count` = "Count",
    `2005_min` = "Min",
    `2005_median` = "Median",
    `2005_max` = "Max",
    `2010_Count` = "Count",
    `2010_min` = "Min",
    `2010_median` = "Median",
    `2010_max` = "Max",
    `2015_Count` = "Count",
    `2015_min` = "Min",
    `2015_median` = "Median",
    `2015_max` = "Max"
  ) %>%
  tab_spanner(
    label = "2005",
    columns = vars(contains("2005_"))
  ) %>%
  tab_spanner(
    label = "2010",
    columns = vars(contains("2010_"))
  ) %>%
  tab_spanner(
    label = "2015",
    columns = vars(contains("2015_"))
  ) %>%
  data_color(
    columns = -1,  # Assuming dest is the first column
    colors = scales::col_numeric(
      palette = c("white", "lightblue"),
      domain = NULL
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "lightgray"),
    locations = cells_body()
  )

# Display the table
gt_output


```







```{r}
library(dplyr)
library(tidyr)
library(gt)

# Filter for walking trips, selected years, and calculate statistics
walking_stats_data <- trip %>%
  filter(MODE == "walking", YEAR %in% c(1986, 1992, 1998)) %>%
  group_by(YEAR, dest) %>%
  summarise(
    Count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(Count, min, median, max), names_to = "statistic") %>%
  unite("YEAR_statistic", YEAR, statistic, sep = "_")

# Pivot data to have years as columns
wide_data <- walking_stats_data %>%
  pivot_wider(names_from = YEAR_statistic, values_from = value)

# Create the table using gt
gt_output <- wide_data %>%
  gt() %>%
  tab_header(
    title = "Walking Trip Duration Statistics by Destination for Selected Years"
  ) %>%
  cols_label(
    dest = "Destination",
    `1986_Count` = "Count",
    `1986_min` = "Min",
    `1986_median` = "Median",
    `1986_max` = "Max",
    `1992_Count` = "Count",
    `1992_min` = "Min",
    `1992_median` = "Median",
    `1992_max` = "Max",
    `1998_Count` = "Count",
    `1998_min` = "Min",
    `1998_median` = "Median",
    `1998_max` = "Max"
  ) %>%
  tab_spanner(
    label = "1986",
    columns = vars(contains("1986_"))
  ) %>%
  tab_spanner(
    label = "1992",
    columns = vars(contains("1992_"))
  ) %>%
  tab_spanner(
    label = "1998",
    columns = vars(contains("1998_"))
  ) %>%
  data_color(
    columns = -1,  # Assuming dest is the first column
    colors = scales::col_numeric(
      palette = c("white", "lightblue"),
      domain = NULL
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "lightgray"),
    locations = cells_body()
  )

# Display the table
gt_output

```


```{r}
library(dplyr)
library(tidyr)
library(gt)

# Filter for walking and cycling trips, selected years, and calculate statistics
trip_stats_data <- trip %>%
  filter(MODE %in% c("walking", "cycling"), YEAR %in% c(1986, 1992, 1998)) %>%
  group_by(YEAR, dest, MODE) %>%
  summarise(
    Count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  )

# Calculate percentages
total_counts <- trip_stats_data %>% group_by(YEAR, MODE) %>% summarise(total_count = sum(Count), .groups = "drop")
trip_stats_data <- left_join(trip_stats_data, total_counts, by = c("YEAR", "MODE"))
# Calculate percentages and round to one decimal
trip_stats_data$Percentage <- round((trip_stats_data$Count / trip_stats_data$total_count) * 100, 1)


# Pivot data to have years as columns and MODE as rows
wide_data <- trip_stats_data %>%
  pivot_wider(
    id_cols = c(dest, MODE),  # Ensure MODE is an identifier here
    names_from = YEAR,
    values_from = c(min, median, max, Percentage)
  )


gt_output <- wide_data %>%
  gt() %>%
  tab_header(
    title = "Walking & Cycling Trip Duration Statistics by Destination for Selected Years"
  ) %>%
  cols_label(
    dest = "Destination",
    MODE = "Mode"
  ) %>%
  tab_spanner(
    label = "1986",
    columns = vars(min_1986, median_1986, max_1986, Percentage_1986)
  ) %>%
  tab_spanner(
    label = "1992",
    columns = vars(min_1992, median_1992, max_1992, Percentage_1992)
  ) %>%
  tab_spanner(
    label = "1998",
    columns = vars(min_1998, median_1998, max_1998, Percentage_1998)
  ) %>%
  cols_label(
    min_1986 = "Min",
    median_1986 = "Median",
    max_1986 = "Max",
    Percentage_1986 = "Percentage",
    min_1992 = "Min",
    median_1992 = "Median",
    max_1992 = "Max",
    Percentage_1992 = "Percentage",
    min_1998 = "Min",
    median_1998 = "Median",
    max_1998 = "Max",
    Percentage_1998 = "Percentage"
  ) %>%
  tab_style(
    style = cell_fill(color = "lightgray"),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_borders(side = "right", weight = px(2), color = "darkgray"),
    locations = cells_body(columns = vars(Percentage_1986)) # For border after 1986
  ) %>%
  tab_style(
    style = cell_borders(side = "right", weight = px(2), color = "darkgray"),
    locations = cells_body(columns = vars(Percentage_1992)) # For border after 1992
  ) %>%
  tab_options(
    table.align = "center"
  ) %>%
  cols_align(
    align = "center",
    columns = everything()
  )

# Display the table
gt_output

```





```{r}
library(dplyr)
library(tidyr)
library(gt)
library(purrr)

# Filter for walking trips and calculate statistics
walking_stats_data <- trip %>%
  filter(MODE == "walking") %>%
  group_by(YEAR, dest) %>%
  summarise(
    Count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(Count, min, median, max), names_to = "statistic") %>%
  unite("YEAR_statistic", YEAR, statistic, sep = "_")

# Pivot data to have years as columns
wide_data <- walking_stats_data %>%
  pivot_wider(names_from = YEAR_statistic, values_from = value)

# Create the table using gt
gt_output <- wide_data %>%
  gt() %>%
  tab_header(
    title = "Walking Trip Duration Statistics by Destination for All Years"
  ) %>%
  tab_spanner_delim(
    delim="_",
    columns=vars(-dest)
  ) %>%
  data_color(
    columns = -1,  # Assuming dest is the first column
    colors = scales::col_numeric(
      palette = c("white", "lightblue"),
      domain = NULL
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "lightgray"),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels(columns = everything())
  ) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_body(columns = everything())
  ) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = everything())
  ) 

# Add right border to the max column of each year
for (yr in all_years) {
  column_name <- paste0(yr, "_max")
  gt_output <- gt_output %>%
    tab_style(
      style = cell_borders(
        sides = "right",
        color = "darkgray",
        weight = px(2)
      ),
      locations = cells_body(columns = column_name)
    )
}

# Add dark gray border between 'dest' and the first year's columns
gt_output <- gt_output %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "darkgray",
      weight = px(2)
    ),
    locations = cells_body(columns = "dest")
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "darkgray",
      weight = px(2)
    ),
    locations = cells_column_labels(columns = "dest")
  )

# Display the table
gt_output

```



```{r}
library(dplyr)
library(tidyr)
library(gt)

# Filter for walking trips and calculate statistics
walking_stats_data <- trip %>%
  filter(MODE == "walking") %>%
  group_by(YEAR, dest) %>%
  summarise(
    Count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  )

# Calculate the percentage
total_counts <- walking_stats_data %>%
  group_by(YEAR) %>%
  summarise(Total = sum(Count), .groups = "drop")

walking_stats_data <- left_join(walking_stats_data, total_counts, by = "YEAR") %>%
  mutate(Percentage = (Count / Total) * 100) %>%
  select(-Total)

# Convert data to long format and then to wide format
wide_data <- walking_stats_data %>%
  select(YEAR, dest, Count, Percentage, min, median, max) %>%
  pivot_longer(cols = c(Count, Percentage, min, median, max), names_to = "statistic") %>%
  unite("YEAR_statistic", YEAR, statistic, sep = "_") %>%
  pivot_wider(names_from = YEAR_statistic, values_from = value)

# Create the table using gt
gt_output <- wide_data %>%
  gt() %>%
  tab_header(
    title = "Walking Trip Duration Statistics by Destination for All Years"
  ) %>%
  fmt_number(
    columns = vars(contains("_Percentage")), 
    decimals = 1
  ) %>%
  cols_label(dest = "Destination") %>%
  data_color(
    columns = -1,
    colors = scales::col_numeric(
      palette = c("white", "lightblue"),
      domain = NULL
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "lightgray"),
    locations = cells_body()
  )

# Add spanners for all unique years and rename columns
unique_years <- unique(trip$YEAR)
for (year in unique_years) {
  gt_output <- gt_output %>%
    tab_spanner(
      label = as.character(year),
      columns = vars(contains(paste0(year, "_")))
    ) %>%
    cols_label(
      !!paste0(year, "_Count") := "Count",
      !!paste0(year, "_Percentage") := "Percentage (%)",
      !!paste0(year, "_min") := "Min",
      !!paste0(year, "_median") := "Median",
      !!paste0(year, "_max") := "Max"
    )
}

# Display the table
gt_output



```


```{r}
library(dplyr)
library(tidyr)
library(gt)

# Filter for walking trips and calculate statistics
walking_stats_data <- trip %>%
  filter(MODE == "walking") %>%
  group_by(YEAR, dest) %>%
  summarise(
    Count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  )

# Calculate the percentage
total_counts <- walking_stats_data %>%
  group_by(YEAR) %>%
  summarise(Total = sum(Count), .groups = "drop")

walking_stats_data <- left_join(walking_stats_data, total_counts, by = "YEAR") %>%
  mutate(Percentage = (Count / Total) * 100) %>%
  select(-Total)

# Convert data to long format and then to wide format
wide_data <- walking_stats_data %>%
  select(YEAR, dest, Count, Percentage, min, median, max) %>%
  pivot_longer(cols = c(Count, Percentage, min, median, max), names_to = "statistic") %>%
  unite("YEAR_statistic", YEAR, statistic, sep = "_") %>%
  pivot_wider(names_from = YEAR_statistic, values_from = value)


# Create the table using gt
gt_output <- wide_data %>%
  gt() %>%
  tab_header(
    title = "Walking Trip Duration Statistics by Destination for All Years"
  ) %>%
  fmt_number(
    columns = contains("_Percentage"), 
    decimals = 1
  ) %>%
  cols_label(dest = "Destination") %>%
  data_color(
    columns = -1,
    colors = scales::col_numeric(
      palette = c("white", "lightblue"),
      domain = NULL
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "lightgray"),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels(everything())
  ) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_body(everything())
  ) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(everything())
  )

# Add spanners for all unique years, rename columns, and add column borders
unique_years <- unique(trip$YEAR)
for (year in unique_years) {
  col_names <- c(
    paste0(year, "_Count"),
    paste0(year, "_Percentage"),
    paste0(year, "_min"),
    paste0(year, "_median"),
    paste0(year, "_max")
  )
  
  gt_output <- gt_output %>%
    tab_spanner(
      label = as.character(year),
      columns = col_names
    ) %>%
    cols_label(
      !!paste0(year, "_Count") := "Count",
      !!paste0(year, "_Percentage") := "Percentage (%)",
      !!paste0(year, "_min") := "Min",
      !!paste0(year, "_median") := "Median",
      !!paste0(year, "_max") := "Max"
    ) %>%
    tab_style(
      style = cell_borders(
        sides = "right",
        color = "darkgray",
        weight = "2px"
      ),
      locations = cells_body(columns = last(col_names))
    ) %>%
    tab_style(
      style = cell_borders(
        sides = "right",
        color = "darkgray",
        weight = "2px"
      ),
      locations = cells_column_spanners(spanners = as.character(year))
    )
}

# Display the table
gt_output


```




```{r}
library(dplyr)
library(tidyr)
library(gt)

# Filter out the data for the year 1986 and for cycling trips, then calculate statistics
cycling_stats_data <- trip %>%
  filter(MODE == "cycling", YEAR != 1986) %>%
  group_by(YEAR, dest) %>%
  summarise(
    Count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  )

# Calculate the percentage
total_counts <- cycling_stats_data %>%
  group_by(YEAR) %>%
  summarise(Total = sum(Count), .groups = "drop")

cycling_stats_data <- left_join(cycling_stats_data, total_counts, by = "YEAR") %>%
  mutate(Percentage = (Count / Total) * 100) %>%
  select(-Total)

# Convert data to long format and then to wide format
wide_data <- cycling_stats_data %>%
  select(YEAR, dest, Count, Percentage, min, median, max) %>%
  pivot_longer(cols = c(Count, Percentage, min, median, max), names_to = "statistic") %>%
  unite("YEAR_statistic", YEAR, statistic, sep = "_") %>%
  pivot_wider(names_from = YEAR_statistic, values_from = value)

# Prepare the labels for renaming
column_labels <- setNames(names(wide_data), names(wide_data))

# Specific renaming
column_labels["dest"] <- "Destination"
unique_years <- unique(trip$YEAR[trip$YEAR != 1986])
for (year in unique_years) {
  column_labels[paste0(year, "_Count")] <- "Count"
  column_labels[paste0(year, "_Percentage")] <- "Percentage (%)"
  column_labels[paste0(year, "_min")] <- "Min"
  column_labels[paste0(year, "_median")] <- "Median"
  column_labels[paste0(year, "_max")] <- "Max"
}

# Create the table using gt
gt_output <- wide_data %>%
  gt() %>%
  tab_header(
    title = "Cycling Trip Duration Statistics by Destination for All Years Excluding 1986"
  ) %>%
  fmt_number(
    columns = contains("_Percentage"), 
    decimals = 1
  ) %>%
  cols_label(!!!column_labels) %>%
  data_color(
    columns = setdiff(names(wide_data), "dest"),
    colors = scales::col_numeric(
      palette = c("white", "lightblue"),
      domain = NULL
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "lightgray"),
    locations = cells_body()
  )

# Add spanners for all unique years (excluding 1986)
for (year in unique_years) {
  gt_output <- gt_output %>%
    tab_spanner(
      label = as.character(year),
      columns = contains(as.character(year))
    )
}

# Display the table
gt_output


```

```{r}
# Define the function to create the table
create_table <- function(data, years, modes) {
  
  # Filter the data
  data_filtered <- data %>%
    filter(YEAR %in% years & MODE %in% modes)
  
  # Calculate the stats
  stats_data <- data_filtered %>%
    group_by(YEAR, MODE, dest) %>%
    summarise(
      Count = n(),
      min = min(DURATION),
      median = median(DURATION),
      max = max(DURATION),
      .groups = "drop"
    )
  
  # Calculate the percentage
  total_counts <- stats_data %>%
    group_by(YEAR, MODE) %>%
    summarise(Total = sum(Count), .groups = "drop")
  
  stats_data <- left_join(stats_data, total_counts, by = c("YEAR", "MODE")) %>%
    mutate(Percentage = (Count / Total) * 100) %>%
    select(-Total)
  
  # Pivot the data for table creation
  wide_data <- stats_data %>%
    select(YEAR, MODE, dest, Count, Percentage, min, median, max) %>%
    pivot_longer(cols = c(Count, Percentage, min, median, max), names_to = "statistic") %>%
    pivot_wider(names_from = c(YEAR, MODE, statistic), values_from = value, names_glue = "{YEAR}_{MODE}_{statistic}")
  
  # Create the table
  gt_output <- wide_data %>%
    gt() %>%
    tab_header(
      title = "Trip Duration Statistics by Destination"
    ) %>%
    fmt_number(
      columns = contains("_Percentage"),
      decimals = 1
    ) %>%
    cols_label(dest = "Destination") %>%
    data_color(
      columns = -1,
      colors = scales::col_numeric(
        palette = c("white", "lightblue"),
        domain = NULL
      )
    ) %>%
    tab_style(
      style = cell_fill(color = "lightgray"),
      locations = cells_body()
    ) %>%
    tab_style(
      style = cell_text(weight = "bold"),
      locations = cells_column_labels(everything())
    ) %>%
    tab_style(
      style = cell_text(align = "center"),
      locations = cells_body(everything())
    ) %>%
    tab_style(
      style = cell_text(align = "center"),
      locations = cells_column_labels(everything())
    )
  
  return(gt_output)
}

# Create the first table (for years 2005, 2010, 2015 and modes walking and cycling)
table1 <- create_table(trip, c(2005, 2010, 2015), c("walking", "cycling"))

# Create the second table (for years from 1986 to 1998 and modes walking and cycling)
table2 <- create_table(trip, 1986:1998, c("walking", "cycling"))

# Print the tables
table1
table2



```



percentage of walking trip during 1986- 2015 :

```{r}
crosstab <- xtabs(~ orig + dest, data = walking_2015)
percentage_table <- round(100 * prop.table(crosstab, 1), 2)

#kable(percentage_table, caption = "Your Table Caption") %>%
#kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)

#crosstab <- xtabs(~ orig + dest, data = walking_2015)
#round(100 * prop.table(crosstab, 1), 2)

#crosstab <- xtabs(~ orig + dest, data = walking_2005)
#round(100 * prop.table(crosstab, 1), 2)

#crosstab <- xtabs(~ orig + dest, data = walking_1998)
#round(100 * prop.table(crosstab, 1), 2)

#crosstab <- xtabs(~ orig + dest, data = walking_1992)
#round(100 * prop.table(crosstab, 1), 2)

#crosstab <- xtabs(~ orig + dest, data = walking_1986)
#round(100 * prop.table(crosstab, 1), 2)
```











percentage of cycling trip during 1992- 2015 :

```{r}
crosstab <- xtabs(~ orig + dest, data = cycling_2015)
round(100 * prop.table(crosstab, 1), 2)

#crosstab <- xtabs(~ origin + destination, data = cycling_2010)
#round(100 * prop.table(crosstab, 1), 2)

#crosstab <- xtabs(~ orig + dest, data = cycling_2005)
#round(100 * prop.table(crosstab, 1), 2)

#crosstab <- xtabs(~ orig + dest, data = cycling_1998)
#round(100 * prop.table(crosstab, 1), 2)

#crosstab <- xtabs(~ orig + dest, data = cycling_1992)
#round(100 * prop.table(crosstab, 1), 2)

```







#Heat map


```{r}
# Install and load necessary packages
library(ggplot2)
library(dplyr)
library(RColorBrewer)

# Calculate the frequency of trips
trip_counts <- walking_2015 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmap_plot_20155 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal()

# Display the heatmap
print(heatmap_plot_20155)

```
# Walking heat map 
```{r}

library(ggplot2)
library(dplyr)
library(RColorBrewer)

# Calculate the frequency of trips
trip_counts <- walking_2015 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmap_plot_2015 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of Walking Trips Categorized by Origin and Destination (2015)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmap_plot_2015)


```


```{r,  2010}

# Calculate the frequency of trips
trip_counts <- walking_2010 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmap_plot_2010 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of Walking Trips Categorized by Origin and Destination (2010)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmap_plot_2010)

```




```{r,  2005}

# Calculate the frequency of trips
trip_counts <- walking_2005 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmap_plot_2005 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of Walking Trips Categorized by Origin and Destination (2005)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmap_plot_2005)
```


```{r, 1998}

# Calculate the frequency of trips
trip_counts <- walking_1998 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmap_plot_1998 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of Walking Trips Categorized by Origin and Destination (1998)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmap_plot_1998)

```


```{r,  1992}

# Calculate the frequency of trips
trip_counts <- walking_1992 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmap_plot_1992 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of Walking Trips Categorized by Origin and Destination (1992)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmap_plot_1992)

```


```{r,  1986}

# Calculate the frequency of trips
trip_counts <- walking_1986 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmap_plot_1986 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of Walking Trips Categorized by Origin and Destination (1986)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmap_plot_1986)

```



```{r}
# Assuming you have a ggplot object named heatmap_plot
ggsave("heatmap_2015.jpg", plot = heatmap_plot_2015, width = 6, height = 6, dpi = 600)
ggsave("heatmap_20155.jpg", plot = heatmap_plot_20155, width = 6, height = 6, dpi = 600)
ggsave("heatmap_2010.jpg", plot = heatmap_plot_2010, width = 6, height = 6, dpi = 600)
ggsave("heatmap_2005.jpg", plot = heatmap_plot_2005, width = 6, height = 6, dpi = 600)
ggsave("heatmap_1998.jpg", plot = heatmap_plot_1998, width = 6, height = 6, dpi = 600)
ggsave("heatmap_1992.jpg", plot = heatmap_plot_1992, width = 6, height = 6, dpi = 600)
ggsave("heatmap_1986.jpg", plot = heatmap_plot_1986, width = 6, height = 6, dpi = 600)

```


# Cycling heat map

```{r}

library(ggplot2)
library(dplyr)
library(RColorBrewer)

# Calculate the frequency of trips
trip_counts <- cycling_2015 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmapc_plot_2015 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of cycling Trips Categorized by Origin and Destination (2015)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmapc_plot_2015)


```


```{r,  2010}

# Calculate the frequency of trips
trip_counts <- cycling_2010 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmapc_plot_2010 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of cycling Trips Categorized by Origin and Destination (2010)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmapc_plot_2010)

```




```{r,  2005}

# Calculate the frequency of trips
trip_counts <- cycling_2005 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmapc_plot_2005 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of cycling Trips Categorized by Origin and Destination (2005)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmapc_plot_2005)
```


```{r, 1998}

# Calculate the frequency of trips
trip_counts <- cycling_1998 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmapc_plot_1998 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of cycling Trips Categorized by Origin and Destination (1998)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmapc_plot_1998)

```


```{r,  1992}

# Calculate the frequency of trips
trip_counts <- cycling_1992 %>%
  group_by(orig, dest) %>%
  tally()

# Convert counts to percentages
trip_counts$percentage <- (trip_counts$n / sum(trip_counts$n)) * 100

# Create heatmap
heatmapc_plot_1992 <- ggplot(trip_counts, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = percentage), color = "white") + # Define the fill color based on the percentage
  scale_fill_gradientn(colors = brewer.pal(9, "Blues")) + # Use the Blues palette
  labs(title = "Percentage of cycling Trips Categorized by Origin and Destination (1992)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Percentage") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmapc_plot_1992)

```



```{r}
# Assuming you have a ggplot object named heatmap_plot
ggsave("heatmapc_2015.jpg", plot = heatmapc_plot_2015, width = 6, height = 6, dpi = 600)
ggsave("heatmapc_20155.jpg", plot = heatmapc_plot_2015, width = 6, height = 6, dpi = 600)
ggsave("heatmapc_2010.jpg", plot = heatmapc_plot_2010, width = 6, height = 6, dpi = 600)
ggsave("heatmapc_2005.jpg", plot = heatmapc_plot_2005, width = 6, height = 6, dpi = 600)
ggsave("heatmapc_1998.jpg", plot = heatmapc_plot_1998, width = 6, height = 6, dpi = 600)
ggsave("heatmapc_1992.jpg", plot = heatmapc_plot_1992, width = 6, height = 6, dpi = 600)

```

# heat map of mean duration

```{r}
library(dplyr)
library(ggplot2)
library(RColorBrewer)

# Calculate the mean duration of trips
mean_durations <- cycling_2010 %>%
  group_by(orig, dest) %>%
  summarise(mean_duration = mean(DURATION, na.rm = TRUE))


heatmapd_plot_2010 <- ggplot(mean_durations, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = mean_duration), color = "white") + # Define the fill color based on the mean duration
  scale_fill_gradientn(colors = brewer.pal(9, "Reds")) + # Use the Reds palette
  labs(title = "Mean Duration of cycling Trips by Origin and Destination (2010)", 
       x = "Origin", 
       y = "Destination", 
       fill = "Mean Duration (mins)") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmapd_plot_2010)

```


```{r}
library(dplyr)

# Filter for DURATION < 100 and then calculate the mean duration of trips
mean_durations <- cycling_2010 %>%
  filter(DURATION < 100) %>%
  group_by(orig, dest) %>%
  summarise(mean_duration = mean(DURATION, na.rm = TRUE))
library(ggplot2)
library(RColorBrewer)

heatmapd_plot_2010 <- ggplot(mean_durations, aes(x = orig, y = dest)) +
  geom_tile(aes(fill = mean_duration), color = "white") + # Define the fill color based on the mean duration
  scale_fill_gradientn(colors = brewer.pal(9, "Reds")) + # Use the Reds palette
  labs(title = "Mean Duration of cycling Trips by Origin and Destination (2010) for Durations < 100 mins", 
       x = "Origin", 
       y = "Destination", 
       fill = "Mean Duration (mins)") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 8, color = "black"),
    axis.text.y = element_text(size = 8, color = "black")
  )

# Display the heatmap
print(heatmapd_plot_2010)

```






```{r walking_2015, include=FALSE, cache=FALSE}

# **walking 2015**
# Creating data of origins and destinations of walking trip 2015
inds = which(gss_e_2015$LOCATION == 315)
rows <- lapply(inds, function(x) (x-1):(x+1))
walking_2015 <- gss_e_2015 [unlist(rows),] %>% 
  dplyr::select(PUMFID:LOCATION) %>% 
  mutate(origin = lag(LOCATION, order_by = PUMFID)) %>% 
  mutate(destination = lead(LOCATION, order_by = PUMFID)) %>% 
  group_by(PUMFID) %>% 
  filter(LOCATION == 315) %>% 
  ungroup()

# change destination and origins to text column
walking_2015 <- walking_2015 %>%  filter(destination == 300 | destination == 301 | destination == 303 | destination == 302 | destination == 305 |destination == 306 | destination == 307 |destination == 309 | destination == 310 ) %>% filter(origin == 300 | origin == 301 | origin == 303 | origin == 302 | origin == 305 | origin == 306 | origin == 307  | origin == 309 | origin == 310 ) %>% 
  mutate(dest =
                     case_when(destination == 300 ~ "home", 
                               destination == 301 ~ "work or school",
                               destination == 303 ~ "other's home",
                               destination == 302 ~ "business",
                               destination == 305 ~ "outdoors",
                               destination == 306 ~ "Grocery store, other stores or mall",
                               destination == 307 ~ "Library, museum or theatre",
                               destination == 309 ~ "Restaurant, bar or club",
                               destination == 310 ~ "Place of worship")) %>% 
  mutate(orig =
                     case_when(origin == 300 ~ "home", 
                               origin == 301 ~ "work or school",
                               origin == 303 ~ "other's home",
                               origin == 302 ~ "business",
                               origin == 305 ~ "outdoors",
                               origin == 306 ~ "Grocery store, other stores or mall",
                               origin == 307 ~ "Library, museum or theatre",
                               origin == 309 ~ "Restaurant, bar or club",
                               origin == 310 ~ "Place of worship"))

walking_2015 <- walking_2015 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
walking_2015$YEAR <-  2015
walking_2015$MODE <-  "walking"
```


```{r cycling_2015, include=FALSE, cache=FALSE}

# cycling _2015
# Creating data of origins and destinations of cycling trip 2015
inds = which(gss_e_2015$LOCATION == 318)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycling_2015 <- gss_e_2015[unlist(rows),] %>% 
  dplyr::select(PUMFID:LOCATION) %>% 
  mutate(origin = lag(LOCATION, order_by = PUMFID)) %>% 
  mutate(destination = lead(LOCATION, order_by = PUMFID)) %>% 
  group_by(PUMFID) %>% 
  filter(LOCATION == 318)

# change destination and origins to text column
cycling_2015 <- cycling_2015 %>%  filter(destination == 300 | destination == 301 | destination == 303 | destination == 302 | destination == 305 |destination == 306 | destination == 307 | destination == 309 | destination == 310 ) %>% filter(origin == 300 | origin == 301 | origin == 303 | origin == 302 | origin == 305 | origin == 306 | origin == 307 | origin == 309 | origin == 310) %>% 
  mutate(dest =
                     case_when(destination == 300 ~ "home", 
                               destination == 301 ~ "work or school",
                               destination == 303 ~ "other's home",
                               destination == 302 ~ "business",
                               destination == 305 ~ "outdoors",
                               destination == 306 ~ "Grocery store, other stores or mall",
                               destination == 307 ~ "Library, museum or theatre",
                               destination == 309 ~ "Restaurant, bar or club",
                               destination == 310 ~ "Place of worship")) %>% 
  mutate(orig =
                     case_when(origin == 300 ~ "home", 
                               origin == 301 ~ "work or school",
                               origin == 303 ~ "other's home",
                               origin == 302 ~ "business",
                               origin == 305 ~ "outdoors",
                               origin == 306 ~ "Grocery store, other stores or mall",
                               origin == 307 ~ "Library, museum or theatre",
                               origin == 309 ~ "Restaurant, bar or club",
                               origin == 310 ~ "Place of worship"))

cycling_2015 <- cycling_2015 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
cycling_2015$YEAR <-  2015
cycling_2015$MODE <-  "cycling"
```

```{r walking_2010, include=FALSE, cache=FALSE}

# **walking 2010**
# Creating data of origins and destinations of walking trip 2010
inds = which(gss_e_2010$PLACE == 14)
rows <- lapply(inds, function(x) (x-1):(x+1))
walking_2010 <- gss_e_2010 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 14) %>% 
  ungroup()

# change destination and origins to text column
walking_2010 <- walking_2010 %>%  filter(destination == 1 | destination == 2 | destination == 3 | destination == 4 | destination == 5 |destination == 6 | destination == 7 | destination == 8 | destination == 9 | destination == 10 ) %>% filter(origin == 1 | origin == 2 | origin == 3 | origin == 4 | origin == 5 | origin == 6 | origin == 7 | origin == 8 | origin == 9 | origin == 10) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home",
                               destination == 4 ~ "Restaurant/bar",
                               destination == 5 ~ "Place of worship",
                               destination == 6 ~ "Grocery store, other stores or mall",
                               destination == 7 ~ "Grocery store, other stores or mall",
                               destination == 8 ~ "work or school",
                               destination == 9 ~ "Outdoors away from home",
                               destination == 10 ~ "Library" )) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home",
                               origin == 4 ~ "Restaurant/bar",
                               origin == 5 ~ "Place of worship",
                               origin == 6 ~ "Grocery store, other stores or mall",
                               origin == 7 ~ "Grocery store, other stores or mall",
                               origin == 8 ~ "work or school",
                               origin == 9 ~ "Outdoors away from home",
                               origin == 10 ~ "Library"))

walking_2010 <- walking_2010 %>%
  rename(PUMFID = RECID,
         LOCATION = PLACE)

walking_2010 <- walking_2010 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
walking_2010$YEAR <-  2010
walking_2010$MODE <-  "walking"
```

```{r cycling_2010, include=FALSE, cache=FALSE}

# cycling _2010
# Creating data of origins and destinations of cycling trip 2010
inds = which(gss_e_2010$PLACE == 17)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycling_2010 <- gss_e_2010[unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 17)

# change destination and origins to text column
cycling_2010 <- cycling_2010 %>%  filter(destination == 1 | destination == 2 | destination == 3 | destination == 6 | destination == 7 | destination == 8 | destination == 9 ) %>% filter(origin == 1 | origin == 2 | origin == 3 | origin == 6 | origin == 7 | origin == 8 | origin == 9 ) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home",
                               destination == 6 ~ "Grocery store, other stores or mall",
                               destination == 7 ~ "Grocery store, other stores or mall",
                               destination == 8 ~ "work or school",
                               destination == 9 ~ "Outdoors away from home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home",
                               origin == 6 ~ "Grocery store, other stores or mall",
                               origin == 7 ~ "Grocery store, other stores or mall",
                               origin == 8 ~ "work or school",
                               origin == 9 ~ "Outdoors away from home"))

cycling_2010 <- cycling_2010 %>%
  rename(PUMFID = RECID,
         LOCATION = PLACE)

cycling_2010 <- cycling_2010 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
cycling_2010$YEAR <-  2010
cycling_2010$MODE <-  "cyclingtrip"
```

```{r walking_2005, include=FALSE, cache=FALSE}

# **walking 2005**
# Creating data of origins and destinations of walking trip 2005
inds = which(gss_e_2005$PLACE == 14)
rows <- lapply(inds, function(x) (x-1):(x+1))
walking_2005 <- gss_e_2005 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 14) %>% 
  ungroup()

# change destination and origins to text column
walking_2005 <- walking_2005 %>%  filter(destination == 1 | destination == 2 | destination == 3 | destination == 8 | destination == 4 | destination == 5 | destination == 6 | destination == 7 | destination == 9 | destination == 10 ) %>% filter(origin == 1 | origin == 2 | origin == 3 | origin == 8 | origin == 4 | origin == 5 | origin == 6 | origin == 7 | origin == 9 | origin == 10) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home",
                               destination == 8 ~ "work or school",
                               destination == 4 ~ "Restaurant, bar or club",
                               destination == 5 ~ "Place of worship",
                               destination == 6 ~ "Grocery store, other stores or mall",
                               destination == 7 ~ "Grocery store, other stores or mall",
                               destination == 9 ~ "outdoors",
                               destination == 10 ~ "Library, museum or theatre")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home",
                               origin == 8 ~ "work or school",
                               origin == 4 ~ "Restaurant, bar or club",
                               origin == 5 ~ "Place of worship",
                               origin == 6 ~ "Grocery store, other stores or mall",
                               origin == 7 ~ "Grocery store, other stores or mall",
                               origin == 9 ~ "outdoors",
                               origin == 10 ~ "Library, museum or theatre"))

walking_2005 <- walking_2005 %>% dplyr::rename(
    PUMFID = RECID,
    STARTMIN = STARMIN,
    LOCATION = PLACE)

walking_2005 <- walking_2005 %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
walking_2005$YEAR <-  2005
walking_2005$MODE <-  "walking"
```

```{r cycling_2005, include=FALSE, cache=FALSE}

# **CYCLING 2005**
# Creating data of origins and destinations of cycling trip 2005
inds = which(gss_e_2005$PLACE == 17)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycling_2005 <- gss_e_2005 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 17) %>% 
  ungroup()

# change destination and origins to text column
cycling_2005 <- cycling_2005 %>%  filter(destination == 1 | destination == 2 | destination == 3 | destination == 8 | destination == 4 |  destination == 6 | destination == 7 | destination == 9 ) %>% filter(origin == 1 | origin == 2 | origin == 3 | origin == 8 | origin == 4 | origin == 6 | origin == 7 | origin == 9 ) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home",
                               destination == 8 ~ "work or school",
                               destination == 4 ~ "Restaurant, bar or club",
                               destination == 6 ~ "Grocery store, other stores or mall",
                               destination == 7 ~ "Grocery store, other stores or mall",
                               destination == 9 ~ "outdoors")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home",
                               origin == 8 ~ "work or school",
                               origin == 4 ~ "Restaurant, bar or club",
                               origin == 6 ~ "Grocery store, other stores or mall",
                               origin == 7 ~ "Grocery store, other stores or mall",
                               origin == 9 ~ "outdoors"))

cycling_2005 <- cycling_2005 %>% dplyr::rename(
    PUMFID = RECID,
    STARTMIN = STARMIN,
    LOCATION = PLACE) %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
cycling_2005$YEAR <-  2005
cycling_2005$MODE <-  "cycling"
```

```{r  walking_1998, include=FALSE, cache=FALSE}

# **walking 1998**
# Creating data of origins and destinations of walking trip 1998
inds = which(gss_e_1998$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
walking_1998 <- gss_e_1998 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 7) %>% 
  ungroup()

# change destination and origins to text column
walking_1998 <- walking_1998 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

walking_1998 <- walking_1998 %>% dplyr::rename(
    PUMFID = RECID,
    STARTMIN = STARMIN,
    WGHT_EPI = WGHTEPI,
    LOCATION = PLACE) %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
walking_1998$YEAR <-  1998
walking_1998$MODE <-  "walking"
```

```{r  cycling_1998, include=FALSE, cache=FALSE}

# **Cycling 1998**
# Creating data of origins and destinations of cycling trip 1998
inds = which(gss_e_1998$PLACE == 9)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycling_1998 <- gss_e_1998 [unlist(rows),] %>% 
  dplyr::select(RECID:PLACE) %>% 
  mutate(origin = lag(PLACE, order_by = RECID)) %>% 
  mutate(destination = lead(PLACE, order_by = RECID)) %>% 
  group_by(RECID) %>% 
  filter(PLACE == 9) %>% 
  ungroup()

# change destination and origins to text column
cycling_1998 <- cycling_1998 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

cycling_1998 <- cycling_1998 %>% dplyr::rename(
    PUMFID = RECID,
    STARTMIN = STARMIN,
    WGHT_EPI = WGHTEPI,
    LOCATION = PLACE) %>%  dplyr::select(PUMFID, WGHT_EPI, DDAY, STARTIME:orig) 
cycling_1998$YEAR <-  1998
cycling_1998$MODE <-  "cycling"
```

```{r  walking_1992, include=FALSE, cache=FALSE}
# **walking 1992**
# Creating data of origins and destinations of walking trip 1992
inds = which(gss_e_1992$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
walking_1992 <- gss_e_1992 [unlist(rows),] %>% 
  dplyr::select(SEQNUM, DDAY, NOEPISO, ACTCODE, STARTIME, ENDTIME, DURATION, PLACE, TIMEWGT) %>% 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) %>% 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) %>% 
  group_by(SEQNUM) %>% 
  filter(PLACE == 7) %>% 
  ungroup()

# change NA's Weight to 1 


# change destination and origins to text column
walking_1992 <- walking_1992 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

walking_1992 <- walking_1992 %>% dplyr::rename(
    PUMFID = SEQNUM,
    LOCATION = PLACE, WGHT_EPI = TIMEWGT) %>%  dplyr::select(PUMFID, DDAY, STARTIME:orig) 
walking_1992$YEAR <-  1992
walking_1992$MODE <-  "walking"
walking_1992$STARTMIN <-  1
walking_1992$ENDMIN <-  1
```

```{r  cycling_1992, include=FALSE, cache=FALSE}

# **Cycling 1992**
# Creating data of origins and destinations of cycling trip 1992
inds = which(gss_e_1992$PLACE == 9)
rows <- lapply(inds, function(x) (x-1):(x+1))
cycling_1992 <- gss_e_1992 [unlist(rows),] %>% 
  dplyr::select(SEQNUM, DDAY, NOEPISO, ACTCODE, STARTIME, ENDTIME, DURATION, PLACE, TIMEWGT) %>% 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) %>% 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) %>% 
  group_by(SEQNUM) %>% 
  filter(PLACE == 9) %>% 
  ungroup()

# change destination and origins to text column
cycling_1992 <- cycling_1992 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

cycling_1992 <- cycling_1992 %>% dplyr::rename(
    PUMFID = SEQNUM,
    LOCATION = PLACE,WGHT_EPI = TIMEWGT) %>%  dplyr::select(PUMFID, DDAY, STARTIME:orig) 
cycling_1992$YEAR <-  1992
cycling_1992$MODE <-  "cycling"
cycling_1992$STARTMIN <-  1
cycling_1992$ENDMIN <-  1

```

```{r  walking_1986, include=FALSE, cache=FALSE}

# **walking 1986**
# Creating data of origins and destinations of walking trip 1986
inds = which(gss_e_1986$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
walking_1986 <- gss_e_1986 [unlist(rows),] %>% 
  dplyr::select(SEQNUM, DDAY, NO_EPISO, ACT_CODE, STRTTIME, ENDTIME, DURATION, PLACE, FWGT_MS) %>% 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) %>% 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) %>% 
  group_by(SEQNUM) %>% 
  filter(PLACE == 7) %>% 
  ungroup()
summary(walking_1986$PLACE)

# change destination and origins to text column
walking_1986 <- walking_1986 %>%  filter(destination == 1 | destination == 2 | destination == 3) %>% filter(origin == 1 | origin == 2 | origin == 3) %>% 
  mutate(dest =
                     case_when(destination == 1 ~ "home", 
                               destination == 2 ~ "work or school",
                               destination == 3 ~ "other's home")) %>% 
  mutate(orig =
                     case_when(origin == 1 ~ "home", 
                               origin == 2 ~ "work or school",
                               origin == 3 ~ "other's home"))

walking_1986 <- walking_1986 %>% dplyr::rename(
    PUMFID = SEQNUM,
    LOCATION = PLACE, WGHT_EPI = FWGT_MS, STARTIME = STRTTIME) %>%  dplyr::select(PUMFID, DDAY, STARTIME:orig) 
walking_1986$YEAR <-  1986
walking_1986$MODE <-  "walking"
walking_1986$STARTMIN <-  1
walking_1986$ENDMIN <-  1
```



```{r}
library(tidyr)
library(dplyr)
library(gt)

# Create the crosstab table
crosstab <- xtabs(~ orig + dest, data = walking_2015)

# Convert to a percentage matrix
percentage_matrix <- round(100 * prop.table(crosstab, 1), 2)

# Add total row and column
percentage_matrix <- rbind(percentage_matrix, Total = colSums(percentage_matrix))
percentage_matrix <- cbind(percentage_matrix, Total = rowSums(percentage_matrix))

# Convert the matrix to a dataframe
crosstab_df <- as.data.frame(as.table(percentage_matrix))

# Using gt to display the crosstab
gt(crosstab_df) %>%
  tab_header(title = "Cross-tab of Walking Trip Percentages by Orig and Dest") %>%
  fmt_number(columns = vars(Freq), decimals = 2) %>%
  tab_source_note(source_note = "All values are in percentages.")


```







# IMPEDANCE

```{r}
# plotting histograms
trip_w <- trip %>%  filter(MODE == "walking")
ggplot(trip_w, aes(x = DURATION)) + geom_histogram() + facet_grid(.~YEAR)


# plotting weighted histograms
trip_w <- trip %>%  filter(MODE == "walking")
ggplot(trip_w, aes(x = DURATION, weight = WGHT_EPI)) + geom_histogram() 


```






\*\* Impedance function for different destination \*\*

```{r}
ggplot() + geom_line(data = trip_w_f, aes(x = DURATION, y = f), linetype="dashed") + facet_grid(dest~YEAR) 
```



\*\* Impedance function for different destination \*\*

```{r}
trip_c_f <- trip_c_f %>%  filter(MODE == "cycling")
ggplot() + geom_line(data = trip_c_f, aes(x = DURATION, y = f), linetype="dashed") + facet_grid(dest~YEAR) 
```




```{r}
library(ggplot2)
library(dplyr)

# Filter the dataset for walking mode
trip_walking <- trip %>% 
  filter(MODE == "walking")

# Create the plot
plot <- ggplot(trip_walking, aes(x = DURATION, y = f)) + 
  geom_line(aes(group = 1)) +  # Ensuring a single line is drawn
  facet_wrap(~ YEAR, scales = "free") +  # Facet by YEAR 
  scale_x_continuous(breaks = c(0, 25, 50, 75, 100)) +  # Setting breaks on x-axis
  labs(title = "Line Graph of DURATION vs f by Year for Walking Mode", 
       x = "DURATION", 
       y = "Impedance function") +
  theme_minimal()

# Print the plot
print(plot)

```


```{r}
library(ggplot2)
library(dplyr)

# Filter the dataset for cycling mode
trip_cycling <- trip %>% 
  filter(MODE == "cycling")

# Create the plot
plot <- ggplot(trip_cycling, aes(x = DURATION, y = f)) + 
  geom_line(aes(group = 1)) +  # Ensuring a single line is drawn
  facet_wrap(~ YEAR, scales = "free") +  # Facet by YEAR 
  scale_x_continuous(breaks = c(0, 25, 50, 75, 100)) +  # Setting breaks on x-axis
  labs(title = "Line Graph of DURATION vs f by Year for cycling Mode", 
       x = "DURATION", 
       y = "f") +
  theme_minimal()

# Print the plot
print(plot)

```

# Creating a dataset for Impedance function based on different porpuses



```{r}
library(dplyr)

walking_2015_f <- walking_2015_f %>%
  mutate(f_t = coalesce(f_300, f_301, f_302, f_303, f_305, f_306, f_307, f_309, f_310))
walking_2010_f <- walking_2010_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3, f_6, f_9))
walking_2005_f <- walking_2005_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3, f_4, f_5, f_6, f_9, f_10))
walking_1998_f <- walking_1998_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3))
walking_1992_f <- walking_1992_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3))
walking_1986_f <- walking_1986_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3))

cycling_2015_f <- cycling_2015_f %>%
  mutate(f_t = coalesce(f_300, f_301, f_303, f_306, f_309))
cycling_2010_f <- cycling_2010_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3, f_6, f_9))
cycling_2005_f <- cycling_2005_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3, f_4, f_6, f_9))
cycling_1998_f <- cycling_1998_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3))
cycling_1992_f <- cycling_1992_f %>%
  mutate(f_t = coalesce(f_1, f_2, f_3))

```




```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home", "Grocery store, other stores or mall")

# Filter the data frame to include only the specified destinations
w_2015_a <- walking_2015_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#w_2015_a <- w_2015_a %>%
#  mutate(f_t = f_t * 1000)

# Create the plot with the modified line style
ggplot(w_2015_a, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1.005) +  # Adjust line thickness and style
  labs(title = "2015 (a)",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(w_2015_a$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2 , # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "w_2015_1.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)

```


```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("outdoors", "Library, museum or theatre", "Place of worship", "Restaurant, bar or club")

# Filter the data frame to include only the specified destinations
w_2015_b <- walking_2015_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#w_2015_b <- w_2015_b %>%
 # mutate(f_t = f_t * 1000)

# Create the plot with the modified line style
ggplot(w_2015_b, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1.005) +  # Adjust line thickness and style
  labs(title = "2015 (b)",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(w_2015_b$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "w_2015_2.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)

```



```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home", "Grocery store, other stores or mall", "Outdoors away from home")

# Filter the data frame to include only the specified destinations
w_2010 <- walking_2010_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#w_2010 <- w_2010 %>%
 #mutate(f_t = f_t * 1000)

# Create the plot with the modified line style
ggplot(w_2010, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1.005) +  # Adjust line thickness and style
  labs(title = "2010 (a)",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(w_2010$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "w_2010_1.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)


```







```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home", "Grocery store, other stores or mall")

# Filter the data frame to include only the specified destinations
w_2005_a <- walking_2005_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#w_2005_a <- w_2005_a %>%
 # mutate(f_t = f_t * 1000)

# Create the plot with the modified line style
ggplot(w_2005_a, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1.005) +  # Adjust line thickness and style
  labs(title = "2005 (a)",
      x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(w_2005_a$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "w_2005_1.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)

```




```{r}
library(ggplot2)

# Define the destinations you want to include
included_destinations <- c("Restaurant, bar or club", "outdoors", "Library, museum or theatre")

# Filter the data frame to include only the specified destinations
w_2005_b <- walking_2005_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#w_2005_b <- w_2005_b %>%
  #mutate(f_t = f_t * 1000)

# Create the plot with the modified line style
ggplot(w_2005_b, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1.005) +  # Adjust line thickness and style
  labs(title = "2005 (b)",
      x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(w_2005_b$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "w_2005_2.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)


```




```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home")

# Filter the data frame to include only the specified destinations
w_1998 <- walking_1998_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#w_1998 <- w_1998 %>%
 # mutate(f_t = f_t * 1000)

# Create the plot with the modified line style
ggplot(w_1998, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1.005) +  # Adjust line thickness and style
  labs(title = "1998",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(w_1998$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "w_1998.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)


```

```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home")

# Filter the data frame to include only the specified destinations
w_1992 <- walking_1992_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#w_1992 <- w_1992 %>%
 # mutate(f_t = f_t * 1000)

# Create the plot with the modified line style
ggplot(w_1992, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1.005) +  # Adjust line thickness and style
  labs(title = "1992",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(w_1992$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "w_1992.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)

```

```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home")

# Filter the data frame to include only the specified destinations
w_1986 <- walking_1986_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#w_1986 <- w_1986 %>%
 # mutate(f_t = f_t * 1000)

# Create the plot with the modified line style
ggplot(w_1986, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1.005) +  # Adjust line thickness and style
  labs(title = "1986",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(w_1986$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "w_1986.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)


```

#CYCLING

```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "Grocery store, other stores or mall", "	
Place of worship", "Restaurant, bar or club")

# Filter the data frame to include only the specified destinations
c_2015 <- cycling_2015_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#filtered_data <- filtered_data %>%
# mutate(f_t = (f_t))

# Create the plot with the modified line style
ggplot(c_2015, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1) +  # Adjust line thickness and style
  labs(title = "2015",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(c_2015$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "c_2015.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)



```



```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home", "Grocery store, other stores or mall", "Outdoors away from home")

# Filter the data frame to include only the specified destinations
c_2010 <- cycling_2010_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#filtered_data <- filtered_data %>%
 #mutate(f_t = (f_t))

# Create the plot with the modified line style
ggplot(c_2010, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1) +  # Adjust line thickness and style
  labs(title = "2010",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(c_2010$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "c_2010.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)


```




```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home", "Grocery store, other stores or mall", "Restaurant, bar or club", "outdoors")

# Filter the data frame to include only the specified destinations
c_2005 <- cycling_2005_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#filtered_data <- filtered_data %>%
 #mutate(f_t = (f_t))

# Create the plot with the modified line style
ggplot(c_2005, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1) +  # Adjust line thickness and style
  labs(title = "2005",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(c_2005$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "c_2005.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)


```



```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home")

# Filter the data frame to include only the specified destinations
c_1998 <- cycling_1998_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#filtered_data <- filtered_data %>%
 #mutate(f_t = (f_t))

# Create the plot with the modified line style
ggplot(c_1998, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1) +  # Adjust line thickness and style
  labs(title = "1998",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(c_1998$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "c_1998.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)


```



```{r}
library(ggplot2)
# Define the destinations you want to include
included_destinations <- c("home", "work or school", "other's home")

# Filter the data frame to include only the specified destinations
c_1992 <- cycling_1992_f %>%
  filter(dest %in% included_destinations)

# Multiply the values in the f_t column by 1000
#filtered_data <- filtered_data %>%
 #mutate(f_t = (f_t))

# Create the plot with the modified line style
ggplot(c_1992, aes(x = DURATION, y = f_t, color = dest)) +
  geom_line(size = 1) +  # Adjust line thickness and style
  labs(title = "1992",
       x = "Time (minutes)",
       y = "f(Cij)",
       color = "Destination") +
  scale_x_continuous(breaks = seq(0, max(c_1992$DURATION), by = 10)) +
  theme(aspect.ratio = 1/2, # Adjust the aspect ratio if needed
  plot.title = element_text(hjust = 0.5)) # Center-align the title

# Specify the filename and other parameters
filename <- "c_1992.jpg"  
width <- 8  # Width in inches
height <- 6  # Height in inches
dpi <- 300  # DPI (dots per inch)

# Save the graph as a JPG with specified parameters
ggsave(filename, width = width, height = height, dpi = dpi)


```




```{r}

```








```{r copy f_t column to major dataset in order to create an integrated dataset}

walking_2015$f_t <- walking_2015_f$f_t
walking_2010$f_t <- walking_2010_f$f_t
walking_2005$f_t <- walking_2005_f$f_t
walking_1998$f_t <- walking_1998_f$f_t
walking_1992$f_t <- walking_1992_f$f_t
walking_1986$f_t <- walking_1986_f$f_t

cycling_2015$f_t <- cycling_2015_f$f_t
cycling_2010$f_t <- cycling_2010_f$f_t
cycling_2005$f_t <- cycling_2005_f$f_t
cycling_1998$f_t <- cycling_1998_f$f_t
cycling_1992$f_t <- cycling_1992_f$f_t
```





```{r}
library(ggplot2)
library(dplyr)

# Filter out rows with NA in f_t and DURATION
filtered_data <- walking_2015 

# Create the plot
plot <- ggplot(filtered_data, aes(x = DURATION, y = f_t, color = dest)) + 
  geom_line() +
  labs(title = "Line Graph for walking_2015 Dataset",
       x = "DURATION", 
       y = "f_t",
       color = "Destination") +
  theme_minimal()

# Print the plot
print(plot)

```



```



```{r}
library(ggplot2)
library(dplyr)

# Filter rows based on dest = "home" and also remove rows with NA in f_t and DURATION
filtered_data <- walking_2015_f %>%
filter(!is.na(f_307))

# Create the plot
plot <- ggplot(filtered_data, aes(x = DURATION, y = f_307)) + 
  geom_line() +
  labs(title = "Line Graph for walking_2015 Dataset with dest = home",
       x = "DURATION", 
       y = "f_t") +
  theme_minimal()

# Print the plot
print(plot)

```





```{r}
g1 <- ggplot(cycling_2015, aes(x = DURATION, y = f))

# A scatter plot with LOESS smooth:
 g1 +
  geom_line()
```
























```{r}
library(dplyr)

# Calculate percentage distribution and mean durations
summary_data <- walking_2010 %>%
  group_by(orig, dest) %>%
  summarise(
    total_trips = n(),
    mean_duration = mean(DURATION, na.rm = TRUE),
    .groups = "drop"
  )

# Convert total trips to percentages
summary_data$percentage <- (summary_data$total_trips / sum(summary_data$total_trips)) * 100

```

```{r}
# Percentage Distribution Matrix
percentage_matrix <- spread(summary_data, key = dest, value = percentage, fill = 0)

# Mean Duration Matrix
duration_matrix <- spread(summary_data, key = dest, value = mean_duration, fill = 0)

```









